<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Print Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark {
            @apply bg-gray-900 text-white;
        }
        .light {
            @apply bg-gray-100 text-gray-800;
        }
        .card {
            @apply rounded-xl shadow-lg transition-all duration-300 hover:shadow-xl;
        }
        .btn {
            @apply px-4 py-2 rounded-lg font-medium transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-opacity-50;
        }
        .btn-primary {
            @apply bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500;
        }
        .btn-secondary {
            @apply bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500;
        }
        .btn-success {
            @apply bg-green-600 text-white hover:bg-green-700 focus:ring-green-500;
        }
        .btn-danger {
            @apply bg-red-600 text-white hover:bg-red-700 focus:ring-red-500;
        }
        .input {
            @apply px-4 py-2 rounded-lg border focus:outline-none focus:ring-2 focus:ring-opacity-50 transition-all duration-200;
        }
        .input-dark {
            @apply bg-gray-800 border-gray-700 text-white focus:ring-blue-500;
        }
        .input-light {
            @apply bg-white border-gray-300 text-gray-800 focus:ring-blue-500;
        }
        .card-dark {
            @apply bg-gray-800 text-white;
        }
        .card-light {
            @apply bg-white text-gray-800;
        }
        .tab {
            @apply px-4 py-2 font-medium rounded-t-lg cursor-pointer;
        }
        .tab-active-light {
            @apply bg-white text-blue-600 border-b-2 border-blue-600;
        }
        .tab-inactive-light {
            @apply bg-gray-200 text-gray-600 hover:bg-gray-300;
        }
        .tab-active-dark {
            @apply bg-gray-800 text-blue-400 border-b-2 border-blue-400;
        }
        .tab-inactive-dark {
            @apply bg-gray-700 text-gray-400 hover:bg-gray-600;
        }
        .loader {
            border-top-color: #3498db;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        @-webkit-keyframes spinner {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="light min-h-screen">
    <div id="app" class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Auth Screens -->
        <div id="auth-screen" class="fade-in">
            <div class="flex flex-col items-center justify-center min-h-[80vh]">
                <div class="card card-light w-full max-w-md p-8">
                    <div class="text-center mb-8">
                        <div class="flex justify-center mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9.504 1.132a1 1 0 01.992 0l1.75 1a1 1 0 11-.992 1.736L10 3.152l-1.254.716a1 1 0 11-.992-1.736l1.75-1zM5.618 4.504a1 1 0 01-.372 1.364L5.016 6l.23.132a1 1 0 11-.992 1.736L4 7.723V8a1 1 0 01-2 0V6a.996.996 0 01.52-.878l1.734-.99a1 1 0 011.364.372zm8.764 0a1 1 0 011.364-.372l1.733.99A1.002 1.002 0 0118 6v2a1 1 0 11-2 0v-.277l-.254.145a1 1 0 11-.992-1.736l.23-.132-.23-.132a1 1 0 01-.372-1.364zm-7 4a1 1 0 011.364-.372L10 8.848l1.254-.716a1 1 0 11.992 1.736L11 10.58V12a1 1 0 11-2 0v-1.42l-1.246-.712a1 1 0 01-.372-1.364zM3 11a1 1 0 011 1v1.42l1.246.712a1 1 0 11-.992 1.736l-1.75-1A1 1 0 012 14v-2a1 1 0 011-1zm14 0a1 1 0 011 1v2a1 1 0 01-.504.868l-1.75 1a1 1 0 11-.992-1.736L16 13.42V12a1 1 0 011-1zm-9.618 5.504a1 1 0 011.364-.372l.254.145V16a1 1 0 112 0v.277l.254-.145a1 1 0 11.992 1.736l-1.735.992a.995.995 0 01-1.022 0l-1.735-.992a1 1 0 01-.372-1.364z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <h1 class="text-3xl font-bold">3D Print Calculator</h1>
                        <p class="text-gray-600 dark:text-gray-400 mt-2">Gerencie e precifique seus projetos de impressão 3D</p>
                    </div>
                    
                    <div class="flex mb-6">
                        <button id="login-tab" class="tab tab-active-light flex-1 text-center">Login</button>
                        <button id="register-tab" class="tab tab-inactive-light flex-1 text-center">Cadastro</button>
                    </div>
                    
                    <div id="login-form">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2" for="login-email">Email</label>
                            <input type="email" id="login-email" class="input input-light w-full" placeholder="seu@email.com">
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2" for="login-password">Senha</label>
                            <input type="password" id="login-password" class="input input-light w-full" placeholder="••••••••">
                        </div>
                        <div class="flex flex-col gap-4">
                            <button id="login-button" class="btn btn-primary w-full">Entrar</button>
                            <button id="google-login" class="btn flex items-center justify-center gap-2 w-full bg-white text-gray-800 border border-gray-300 hover:bg-gray-100">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24px" height="24px">
                                    <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/>
                                    <path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"/>
                                    <path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"/>
                                    <path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"/>
                                </svg>
                                Entrar com Google
                            </button>
                        </div>
                    </div>
                    
                    <div id="register-form" class="hidden">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2" for="register-name">Nome</label>
                            <input type="text" id="register-name" class="input input-light w-full" placeholder="Seu nome">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2" for="register-email">Email</label>
                            <input type="email" id="register-email" class="input input-light w-full" placeholder="seu@email.com">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2" for="register-password">Senha</label>
                            <input type="password" id="register-password" class="input input-light w-full" placeholder="••••••••">
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2" for="register-confirm-password">Confirmar Senha</label>
                            <input type="password" id="register-confirm-password" class="input input-light w-full" placeholder="••••••••">
                        </div>
                        <div class="flex flex-col gap-4">
                            <button id="register-button" class="btn btn-primary w-full">Cadastrar</button>
                            <button id="google-register" class="btn flex items-center justify-center gap-2 w-full bg-white text-gray-800 border border-gray-300 hover:bg-gray-100">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24px" height="24px">
                                    <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/>
                                    <path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"/>
                                    <path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"/>
                                    <path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"/>
                                </svg>
                                Cadastrar com Google
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div id="main-app" class="hidden fade-in">
            <!-- Header -->
            <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-blue-600 mr-3" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.504 1.132a1 1 0 01.992 0l1.75 1a1 1 0 11-.992 1.736L10 3.152l-1.254.716a1 1 0 11-.992-1.736l1.75-1zM5.618 4.504a1 1 0 01-.372 1.364L5.016 6l.23.132a1 1 0 11-.992 1.736L4 7.723V8a1 1 0 01-2 0V6a.996.996 0 01.52-.878l1.734-.99a1 1 0 011.364.372zm8.764 0a1 1 0 011.364-.372l1.733.99A1.002 1.002 0 0118 6v2a1 1 0 11-2 0v-.277l-.254.145a1 1 0 11-.992-1.736l.23-.132-.23-.132a1 1 0 01-.372-1.364zm-7 4a1 1 0 011.364-.372L10 8.848l1.254-.716a1 1 0 11.992 1.736L11 10.58V12a1 1 0 11-2 0v-1.42l-1.246-.712a1 1 0 01-.372-1.364zM3 11a1 1 0 011 1v1.42l1.246.712a1 1 0 11-.992 1.736l-1.75-1A1 1 0 012 14v-2a1 1 0 011-1zm14 0a1 1 0 011 1v2a1 1 0 01-.504.868l-1.75 1a1 1 0 11-.992-1.736L16 13.42V12a1 1 0 011-1zm-9.618 5.504a1 1 0 011.364-.372l.254.145V16a1 1 0 112 0v.277l.254-.145a1 1 0 11.992 1.736l-1.735.992a.995.995 0 01-1.022 0l-1.735-.992a1 1 0 01-.372-1.364z" clip-rule="evenodd" />
                    </svg>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold">3D Print Calculator</h1>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Precificação inteligente para impressão 3D</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex items-center">
                        <span class="mr-2 text-sm">Tema:</span>
                        <button id="theme-toggle" class="relative inline-flex items-center h-6 rounded-full w-12 transition-colors focus:outline-none bg-gray-300 dark:bg-gray-600">
                            <span class="absolute left-0.5 bg-white dark:bg-gray-800 w-5 h-5 rounded-full transition-transform duration-300 ease-in-out flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-yellow-500" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
                                </svg>
                            </span>
                        </button>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="hidden md:block">
                            <p id="user-name" class="font-medium"></p>
                            <p id="user-email" class="text-sm text-gray-600 dark:text-gray-400"></p>
                        </div>
                        <div class="relative">
                            <button id="user-menu-button" class="flex items-center justify-center w-10 h-10 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 focus:outline-none">
                                <span id="user-initials" class="font-medium"></span>
                            </button>
                            <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 z-10">
                                <div class="md:hidden px-4 py-2 border-b border-gray-200 dark:border-gray-700">
                                    <p id="menu-user-name" class="font-medium"></p>
                                    <p id="menu-user-email" class="text-sm text-gray-600 dark:text-gray-400"></p>
                                </div>
                                <button id="logout-button" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Sair</button>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Navigation Tabs -->
            <div class="mb-6 border-b border-gray-200 dark:border-gray-700">
                <ul class="flex flex-wrap -mb-px text-sm font-medium text-center">
                    <li class="mr-2">
                        <button class="nav-tab inline-block p-4 border-b-2 border-blue-600 rounded-t-lg active" data-target="calculator-section">Calculadora</button>
                    </li>
                    <li class="mr-2">
                        <button class="nav-tab inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" data-target="projects-section">Projetos</button>
                    </li>
                    <li class="mr-2">
                        <button class="nav-tab inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" data-target="printers-section">Impressoras</button>
                    </li>
                    <li class="mr-2">
                        <button class="nav-tab inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" data-target="filaments-section">Filamentos</button>
                    </li>
                    <li class="mr-2">
                        <button class="nav-tab inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" data-target="clients-section">Clientes</button>
                    </li>
                </ul>
            </div>

            <!-- Calculator Section -->
            <section id="calculator-section" class="section-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Left Column - Input Form -->
                    <div class="lg:col-span-2">
                        <div class="card card-light p-6">
                            <h2 class="text-xl font-semibold mb-4">Dados da Peça</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="piece-name">Nome da Peça</label>
                                    <input type="text" id="piece-name" class="input input-light w-full" placeholder="Ex: Suporte para monitor">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="client-select">Cliente</label>
                                    <select id="client-select" class="input input-light w-full">
                                        <option value="">Selecione um cliente</option>
                                    </select>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="print-time-hours">Tempo (horas)</label>
                                    <input type="number" id="print-time-hours" class="input input-light w-full" min="0" value="0">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="print-time-minutes">Tempo (minutos)</label>
                                    <input type="number" id="print-time-minutes" class="input input-light w-full" min="0" max="59" value="0">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="piece-weight">Peso (gramas)</label>
                                    <input type="number" id="piece-weight" class="input input-light w-full" min="0" step="0.1" value="0">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="printer-select">Impressora</label>
                                    <select id="printer-select" class="input input-light w-full">
                                        <option value="">Selecione uma impressora</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="filament-select">Filamento</label>
                                    <select id="filament-select" class="input input-light w-full">
                                        <option value="">Selecione um filamento</option>
                                    </select>
                                </div>
                            </div>

                            <h2 class="text-xl font-semibold mb-4 mt-8">Custos Operacionais</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="energy-cost">Custo de Energia (R$/kWh)</label>
                                    <input type="number" id="energy-cost" class="input input-light w-full" min="0" step="0.01" value="0.80">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="packaging-cost">Custo de Embalagem (R$)</label>
                                    <input type="number" id="packaging-cost" class="input input-light w-full" min="0" step="0.01" value="0">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="failure-rate">Taxa de Falhas (%)</label>
                                    <input type="number" id="failure-rate" class="input input-light w-full" min="0" max="100" step="0.1" value="5">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="tax-rate">Impostos (%)</label>
                                    <input type="number" id="tax-rate" class="input input-light w-full" min="0" max="100" step="0.1" value="0">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="card-fee">Taxa de Cartão (%)</label>
                                    <input type="number" id="card-fee" class="input input-light w-full" min="0" max="100" step="0.1" value="0">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="ad-cost">Custo com Anúncios (%)</label>
                                    <input type="number" id="ad-cost" class="input input-light w-full" min="0" max="100" step="0.1" value="0">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2" for="markup">Markup (%)</label>
                                    <input type="number" id="markup" class="input input-light w-full" min="0" step="0.1" value="100">
                                </div>
                                <div class="flex items-end">
                                    <button id="calculate-button" class="btn btn-primary w-full">Calcular Preço</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Results -->
                    <div>
                        <div class="card card-light p-6">
                            <h2 class="text-xl font-semibold mb-4">Resumo de Custos</h2>
                            <div id="results-container" class="hidden">
                                <div class="mb-6">
                                    <h3 class="font-medium text-lg mb-2">Custos Diretos</h3>
                                    <div class="grid grid-cols-2 gap-2 text-sm">
                                        <div class="text-gray-600 dark:text-gray-400">Filamento:</div>
                                        <div id="filament-cost" class="text-right font-medium">R$ 0,00</div>
                                        
                                        <div class="text-gray-600 dark:text-gray-400">Energia:</div>
                                        <div id="energy-cost-result" class="text-right font-medium">R$ 0,00</div>
                                        
                                        <div class="text-gray-600 dark:text-gray-400">Amortização:</div>
                                        <div id="depreciation-cost" class="text-right font-medium">R$ 0,00</div>
                                        
                                        <div class="text-gray-600 dark:text-gray-400">Embalagem:</div>
                                        <div id="packaging-cost-result" class="text-right font-medium">R$ 0,00</div>
                                    </div>
                                </div>
                                
                                <div class="mb-6">
                                    <h3 class="font-medium text-lg mb-2">Custos Indiretos</h3>
                                    <div class="grid grid-cols-2 gap-2 text-sm">
                                        <div class="text-gray-600 dark:text-gray-400">Falhas (5%):</div>
                                        <div id="failure-cost" class="text-right font-medium">R$ 0,00</div>
                                        
                                        <div class="text-gray-600 dark:text-gray-400">Impostos:</div>
                                        <div id="tax-cost" class="text-right font-medium">R$ 0,00</div>
                                        
                                        <div class="text-gray-600 dark:text-gray-400">Taxa de Cartão:</div>
                                        <div id="card-fee-cost" class="text-right font-medium">R$ 0,00</div>
                                        
                                        <div class="text-gray-600 dark:text-gray-400">Anúncios:</div>
                                        <div id="ad-cost-result" class="text-right font-medium">R$ 0,00</div>
                                    </div>
                                </div>
                                
                                <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mb-6">
                                    <div class="grid grid-cols-2 gap-2 text-sm">
                                        <div class="text-gray-600 dark:text-gray-400 font-medium">Custo Total:</div>
                                        <div id="total-cost" class="text-right font-medium">R$ 0,00</div>
                                        
                                        <div class="text-gray-600 dark:text-gray-400 font-medium">Markup (100%):</div>
                                        <div id="markup-value" class="text-right font-medium">R$ 0,00</div>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4">
                                    <div class="grid grid-cols-2 gap-2">
                                        <div class="text-blue-800 dark:text-blue-300 font-bold text-lg">Preço Final:</div>
                                        <div id="final-price" class="text-right font-bold text-lg text-blue-800 dark:text-blue-300">R$ 0,00</div>
                                    </div>
                                </div>
                                
                                <div class="mt-6 flex flex-col gap-3">
                                    <button id="save-project-button" class="btn btn-success w-full">Salvar Projeto</button>
                                    <button id="export-pdf-button" class="btn btn-secondary w-full">Exportar PDF</button>
                                </div>
                            </div>
                            
                            <div id="results-placeholder" class="flex flex-col items-center justify-center py-10 text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                </svg>
                                <p class="text-gray-600 dark:text-gray-400">Preencha os dados da peça e clique em "Calcular Preço" para ver o resultado</p>
                            </div>
                        </div>
                        
                        <div class="card card-light p-6 mt-6">
                            <h2 class="text-xl font-semibold mb-4">Distribuição de Custos</h2>
                            <div id="chart-container" class="h-64">
                                <canvas id="costs-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Projects Section -->
            <section id="projects-section" class="section-content hidden">
                <div class="card card-light p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold">Meus Projetos</h2>
                        <div class="flex gap-2">
                            <div class="relative">
                                <input type="text" id="project-search" class="input input-light pl-10" placeholder="Buscar projetos...">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3 top-2.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </div>
                            <select id="project-filter" class="input input-light">
                                <option value="all">Todos</option>
                                <option value="recent">Recentes</option>
                                <option value="client">Por Cliente</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead>
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Nome da Peça</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Cliente</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Data</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Preço Final</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="projects-table-body" class="divide-y divide-gray-200 dark:divide-gray-700">
                                <!-- Projects will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="projects-empty-state" class="hidden py-10 text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">Você ainda não tem projetos salvos</p>
                        <button class="nav-tab btn btn-primary" data-target="calculator-section">Criar Novo Projeto</button>
                    </div>
                </div>
            </section>

            <!-- Printers Section -->
            <section id="printers-section" class="section-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="card card-light p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-semibold">Minhas Impressoras</h2>
                                <button id="add-printer-button" class="btn btn-primary">Adicionar Impressora</button>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead>
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Nome</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Custo (R$)</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Vida Útil (h)</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Potência (W)</th>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="printers-table-body" class="divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Printers will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="printers-empty-state" class="hidden py-10 text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                                </svg>
                                <p class="text-gray-600 dark:text-gray-400 mb-4">Você ainda não cadastrou nenhuma impressora</p>
                                <button id="empty-add-printer-button" class="btn btn-primary">Adicionar Impressora</button>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="card card-light p-6">
                            <h2 class="text-xl font-semibold mb-4">Estatísticas</h2>
                            <div id="printer-stats">
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4 text-center">
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Total de Impressoras</p>
                                        <p id="total-printers" class="text-2xl font-bold text-blue-600 dark:text-blue-400">0</p>
                                    </div>
                                    <div class="bg-green-50 dark:bg-green-900/30 rounded-lg p-4 text-center">
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Valor Total</p>
                                        <p id="total-printers-value" class="text-2xl font-bold text-green-600 dark:text-green-400">R$ 0,00</p>
                                    </div>
                                </div>
                                
                                <div class="mb-6">
                                    <h3 class="font-medium text-sm mb-2 text-gray-600 dark:text-gray-400">Distribuição por Potência</h3>
                                    <div class="h-40">
                                        <canvas id="printers-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="printer-stats-empty" class="hidden py-6 text-center">
                                <p class="text-gray-600 dark:text-gray-400">Adicione impressoras para ver estatísticas</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Filaments Section -->
            <section id="filaments-section" class="section-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="card card-light p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-semibold">Meus Filamentos</h2>
                                <button id="add-filament-button" class="btn btn-primary">Adicionar Filamento</button>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead>
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Nome</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Material</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Fabricante</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Preço/kg (R$)</th>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="filaments-table-body" class="divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Filaments will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="filaments-empty-state" class="hidden py-10 text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5" />
                                </svg>
                                <p class="text-gray-600 dark:text-gray-400 mb-4">Você ainda não cadastrou nenhum filamento</p>
                                <button id="empty-add-filament-button" class="btn btn-primary">Adicionar Filamento</button>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="card card-light p-6">
                            <h2 class="text-xl font-semibold mb-4">Estatísticas</h2>
                            <div id="filament-stats">
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <div class="bg-purple-50 dark:bg-purple-900/30 rounded-lg p-4 text-center">
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Total de Filamentos</p>
                                        <p id="total-filaments" class="text-2xl font-bold text-purple-600 dark:text-purple-400">0</p>
                                    </div>
                                    <div class="bg-indigo-50 dark:bg-indigo-900/30 rounded-lg p-4 text-center">
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Preço Médio/kg</p>
                                        <p id="avg-filament-price" class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">R$ 0,00</p>
                                    </div>
                                </div>
                                
                                <div class="mb-6">
                                    <h3 class="font-medium text-sm mb-2 text-gray-600 dark:text-gray-400">Distribuição por Material</h3>
                                    <div class="h-40">
                                        <canvas id="filaments-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="filament-stats-empty" class="hidden py-6 text-center">
                                <p class="text-gray-600 dark:text-gray-400">Adicione filamentos para ver estatísticas</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Clients Section -->
            <section id="clients-section" class="section-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="card card-light p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-semibold">Meus Clientes</h2>
                                <button id="add-client-button" class="btn btn-primary">Adicionar Cliente</button>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead>
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Nome</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Email</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Telefone</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Projetos</th>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="clients-table-body" class="divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Clients will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="clients-empty-state" class="hidden py-10 text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                </svg>
                                <p class="text-gray-600 dark:text-gray-400 mb-4">Você ainda não cadastrou nenhum cliente</p>
                                <button id="empty-add-client-button" class="btn btn-primary">Adicionar Cliente</button>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="card card-light p-6">
                            <h2 class="text-xl font-semibold mb-4">Estatísticas</h2>
                            <div id="client-stats">
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <div class="bg-teal-50 dark:bg-teal-900/30 rounded-lg p-4 text-center">
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Total de Clientes</p>
                                        <p id="total-clients" class="text-2xl font-bold text-teal-600 dark:text-teal-400">0</p>
                                    </div>
                                    <div class="bg-amber-50 dark:bg-amber-900/30 rounded-lg p-4 text-center">
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Total de Projetos</p>
                                        <p id="total-client-projects" class="text-2xl font-bold text-amber-600 dark:text-amber-400">0</p>
                                    </div>
                                </div>
                                
                                <div class="mb-6">
                                    <h3 class="font-medium text-sm mb-2 text-gray-600 dark:text-gray-400">Clientes mais Ativos</h3>
                                    <div class="h-40">
                                        <canvas id="clients-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="client-stats-empty" class="hidden py-6 text-center">
                                <p class="text-gray-600 dark:text-gray-400">Adicione clientes para ver estatísticas</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modals -->
    <!-- Printer Modal -->
    <div id="printer-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all slide-in">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="printer-modal-title" class="text-xl font-semibold">Adicionar Impressora</h3>
                    <button class="modal-close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <form id="printer-form">
                    <input type="hidden" id="printer-id">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" for="printer-name">Nome da Impressora</label>
                        <input type="text" id="printer-name" class="input input-light w-full" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" for="printer-cost">Custo da Impressora (R$)</label>
                        <input type="number" id="printer-cost" class="input input-light w-full" min="0" step="0.01" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" for="printer-lifespan">Vida Útil (horas)</label>
                        <input type="number" id="printer-lifespan" class="input input-light w-full" min="0" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2" for="printer-power">Potência (Watts)</label>
                        <input type="number" id="printer-power" class="input input-light w-full" min="0" required>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button type="button" class="modal-close btn btn-secondary">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Filament Modal -->
    <div id="filament-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all slide-in">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="filament-modal-title" class="text-xl font-semibold">Adicionar Filamento</h3>
                    <button class="modal-close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <form id="filament-form">
                    <input type="hidden" id="filament-id">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" for="filament-name">Nome do Filamento</label>
                        <input type="text" id="filament-name" class="input input-light w-full" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" for="filament-material">Material</label>
                        <select id="filament-material" class="input input-light w-full" required>
                            <option value="">Selecione um material</option>
                            <option value="PLA">PLA</option>
                            <option value="ABS">ABS</option>
                            <option value="PETG">PETG</option>
                            <option value="TPU">TPU</option>
                            <option value="Nylon">Nylon</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" for="filament-manufacturer">Fabricante</label>
                        <input type="text" id="filament-manufacturer" class="input input-light w-full" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" for="filament-price">Preço por kg (R$)</label>
                        <input type="number" id="filament-price" class="input input-light w-full" min="0" step="0.01" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2" for="filament-notes">Observações</label>
                        <textarea id="filament-notes" class="input input-light w-full" rows="2"></textarea>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button type="button" class="modal-close btn btn-secondary">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Client Modal -->
    <div id="client-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all slide-in">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="client-modal-title" class="text-xl font-semibold">Adicionar Cliente</h3>
                    <button class="modal-close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <form id="client-form">
                    <input type="hidden" id="client-id">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" for="client-name">Nome do Cliente</label>
                        <input type="text" id="client-name" class="input input-light w-full" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" for="client-email">Email</label>
                        <input type="email" id="client-email" class="input input-light w-full">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2" for="client-phone">Telefone</label>
                        <input type="tel" id="client-phone" class="input input-light w-full">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2" for="client-address">Endereço</label>
                        <textarea id="client-address" class="input input-light w-full" rows="2"></textarea>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button type="button" class="modal-close btn btn-secondary">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Project Details Modal -->
    <div id="project-details-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-4 transform transition-all slide-in">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="project-details-title" class="text-xl font-semibold">Detalhes do Projeto</h3>
                    <button class="modal-close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div id="project-details-content">
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Nome da Peça</p>
                            <p id="detail-piece-name" class="font-medium"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Cliente</p>
                            <p id="detail-client-name" class="font-medium"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Data</p>
                            <p id="detail-date" class="font-medium"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Impressora</p>
                            <p id="detail-printer" class="font-medium"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Filamento</p>
                            <p id="detail-filament" class="font-medium"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Tempo de Impressão</p>
                            <p id="detail-print-time" class="font-medium"></p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Peso</p>
                            <p id="detail-weight" class="font-medium"></p>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="font-medium mb-2">Resumo de Custos</h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="text-gray-600 dark:text-gray-400">Filamento:</div>
                            <div id="detail-filament-cost" class="text-right"></div>
                            
                            <div class="text-gray-600 dark:text-gray-400">Energia:</div>
                            <div id="detail-energy-cost" class="text-right"></div>
                            
                            <div class="text-gray-600 dark:text-gray-400">Amortização:</div>
                            <div id="detail-depreciation" class="text-right"></div>
                            
                            <div class="text-gray-600 dark:text-gray-400">Embalagem:</div>
                            <div id="detail-packaging" class="text-right"></div>
                            
                            <div class="text-gray-600 dark:text-gray-400">Falhas:</div>
                            <div id="detail-failure" class="text-right"></div>
                            
                            <div class="text-gray-600 dark:text-gray-400">Impostos:</div>
                            <div id="detail-tax" class="text-right"></div>
                            
                            <div class="text-gray-600 dark:text-gray-400">Taxa de Cartão:</div>
                            <div id="detail-card-fee" class="text-right"></div>
                            
                            <div class="text-gray-600 dark:text-gray-400">Anúncios:</div>
                            <div id="detail-ad-cost" class="text-right"></div>
                            
                            <div class="text-gray-600 dark:text-gray-400 font-medium">Custo Total:</div>
                            <div id="detail-total-cost" class="text-right font-medium"></div>
                            
                            <div class="text-gray-600 dark:text-gray-400 font-medium">Markup:</div>
                            <div id="detail-markup" class="text-right font-medium"></div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4 mb-6">
                        <div class="grid grid-cols-2 gap-2">
                            <div class="text-blue-800 dark:text-blue-300 font-bold">Preço Final:</div>
                            <div id="detail-final-price" class="text-right font-bold text-blue-800 dark:text-blue-300"></div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-2">
                        <button id="delete-project-button" class="btn btn-danger">Excluir</button>
                        <button id="export-project-pdf" class="btn btn-secondary">Exportar PDF</button>
                        <button id="edit-project-button" class="btn btn-primary">Editar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all slide-in">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="confirm-title" class="text-xl font-semibold">Confirmar Exclusão</h3>
                    <button class="modal-close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <p id="confirm-message" class="mb-6">Tem certeza que deseja excluir este item? Esta ação não pode ser desfeita.</p>
                <div class="flex justify-end gap-2">
                    <button class="modal-close btn btn-secondary">Cancelar</button>
                    <button id="confirm-action" class="btn btn-danger">Excluir</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 transform transition-all duration-300 translate-y-20 opacity-0 flex items-center z-50">
        <div id="toast-icon" class="mr-3 text-green-500">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
        </div>
        <div>
            <p id="toast-message" class="font-medium">Operação realizada com sucesso!</p>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase (in a real app, you would use your own Firebase credentials)
        // For demo purposes, we'll simulate Firebase functionality
        const app = {
            auth: {
                currentUser: null,
                onAuthStateChanged(callback) {
                    // Simulate auth state change
                    setTimeout(() => {
                        callback(this.currentUser);
                    }, 500);
                },
                signInWithEmailAndPassword(email, password) {
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            if (email && password) {
                                this.currentUser = {
                                    uid: 'user123',
                                    email: email,
                                    displayName: email.split('@')[0]
                                };
                                resolve(this.currentUser);
                            } else {
                                reject(new Error('Email ou senha inválidos'));
                            }
                        }, 1000);
                    });
                },
                createUserWithEmailAndPassword(email, password) {
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            if (email && password) {
                                this.currentUser = {
                                    uid: 'user123',
                                    email: email,
                                    displayName: email.split('@')[0]
                                };
                                resolve(this.currentUser);
                            } else {
                                reject(new Error('Email ou senha inválidos'));
                            }
                        }, 1000);
                    });
                },
                signInWithPopup() {
                    return new Promise((resolve) => {
                        setTimeout(() => {
                            this.currentUser = {
                                uid: 'user123',
                                email: 'google@example.com',
                                displayName: 'Google User'
                            };
                            resolve({ user: this.currentUser });
                        }, 1000);
                    });
                },
                signOut() {
                    return new Promise((resolve) => {
                        setTimeout(() => {
                            this.currentUser = null;
                            resolve();
                        }, 500);
                    });
                }
            },
            firestore: {
                collection(name) {
                    return {
                        doc(id) {
                            return {
                                set(data) {
                                    return new Promise((resolve) => {
                                        setTimeout(() => {
                                            // Simulate saving to database
                                            const collection = localStorage.getItem(name) ? JSON.parse(localStorage.getItem(name)) : {};
                                            collection[id] = { id, ...data };
                                            localStorage.setItem(name, JSON.stringify(collection));
                                            resolve();
                                        }, 500);
                                    });
                                },
                                get() {
                                    return new Promise((resolve) => {
                                        setTimeout(() => {
                                            const collection = localStorage.getItem(name) ? JSON.parse(localStorage.getItem(name)) : {};
                                            const doc = collection[id];
                                            resolve({
                                                exists: !!doc,
                                                data() {
                                                    return doc;
                                                }
                                            });
                                        }, 300);
                                    });
                                },
                                update(data) {
                                    return new Promise((resolve) => {
                                        setTimeout(() => {
                                            const collection = localStorage.getItem(name) ? JSON.parse(localStorage.getItem(name)) : {};
                                            collection[id] = { ...collection[id], ...data };
                                            localStorage.setItem(name, JSON.stringify(collection));
                                            resolve();
                                        }, 500);
                                    });
                                },
                                delete() {
                                    return new Promise((resolve) => {
                                        setTimeout(() => {
                                            const collection = localStorage.getItem(name) ? JSON.parse(localStorage.getItem(name)) : {};
                                            delete collection[id];
                                            localStorage.setItem(name, JSON.stringify(collection));
                                            resolve();
                                        }, 500);
                                    });
                                }
                            };
                        },
                        where() {
                            return this;
                        },
                        get() {
                            return new Promise((resolve) => {
                                setTimeout(() => {
                                    const collection = localStorage.getItem(name) ? JSON.parse(localStorage.getItem(name)) : {};
                                    const docs = Object.values(collection).map(doc => ({
                                        id: doc.id,
                                        data() {
                                            return doc;
                                        }
                                    }));
                                    resolve({ docs });
                                }, 300);
                            });
                        },
                        add(data) {
                            return new Promise((resolve) => {
                                setTimeout(() => {
                                    const id = 'id_' + Date.now();
                                    const collection = localStorage.getItem(name) ? JSON.parse(localStorage.getItem(name)) : {};
                                    collection[id] = { id, ...data };
                                    localStorage.setItem(name, JSON.stringify(collection));
                                    resolve({ id });
                                }, 500);
                            });
                        }
                    };
                }
            }
        };

        // App State
        const state = {
            theme: 'light',
            currentUser: null,
            printers: [],
            filaments: [],
            clients: [],
            projects: [],
            currentProject: null,
            charts: {}
        };

        // DOM Elements
        const elements = {
            // Auth elements
            authScreen: document.getElementById('auth-screen'),
            loginTab: document.getElementById('login-tab'),
            registerTab: document.getElementById('register-tab'),
            loginForm: document.getElementById('login-form'),
            registerForm: document.getElementById('register-form'),
            loginButton: document.getElementById('login-button'),
            registerButton: document.getElementById('register-button'),
            googleLogin: document.getElementById('google-login'),
            googleRegister: document.getElementById('google-register'),
            
            // Main app elements
            mainApp: document.getElementById('main-app'),
            userMenu: document.getElementById('user-menu'),
            userMenuButton: document.getElementById('user-menu-button'),
            userName: document.getElementById('user-name'),
            userEmail: document.getElementById('user-email'),
            menuUserName: document.getElementById('menu-user-name'),
            menuUserEmail: document.getElementById('menu-user-email'),
            userInitials: document.getElementById('user-initials'),
            logoutButton: document.getElementById('logout-button'),
            themeToggle: document.getElementById('theme-toggle'),
            
            // Navigation tabs
            navTabs: document.querySelectorAll('.nav-tab'),
            sections: document.querySelectorAll('.section-content'),
            
            // Calculator elements
            calculateButton: document.getElementById('calculate-button'),
            resultsContainer: document.getElementById('results-container'),
            resultsPlaceholder: document.getElementById('results-placeholder'),
            saveProjectButton: document.getElementById('save-project-button'),
            exportPdfButton: document.getElementById('export-pdf-button'),
            
            // Printer elements
            addPrinterButton: document.getElementById('add-printer-button'),
            emptyAddPrinterButton: document.getElementById('empty-add-printer-button'),
            printersTableBody: document.getElementById('printers-table-body'),
            printersEmptyState: document.getElementById('printers-empty-state'),
            printerStats: document.getElementById('printer-stats'),
            printerStatsEmpty: document.getElementById('printer-stats-empty'),
            totalPrinters: document.getElementById('total-printers'),
            totalPrintersValue: document.getElementById('total-printers-value'),
            
            // Filament elements
            addFilamentButton: document.getElementById('add-filament-button'),
            emptyAddFilamentButton: document.getElementById('empty-add-filament-button'),
            filamentsTableBody: document.getElementById('filaments-table-body'),
            filamentsEmptyState: document.getElementById('filaments-empty-state'),
            filamentStats: document.getElementById('filament-stats'),
            filamentStatsEmpty: document.getElementById('filament-stats-empty'),
            totalFilaments: document.getElementById('total-filaments'),
            avgFilamentPrice: document.getElementById('avg-filament-price'),
            
            // Client elements
            addClientButton: document.getElementById('add-client-button'),
            emptyAddClientButton: document.getElementById('empty-add-client-button'),
            clientsTableBody: document.getElementById('clients-table-body'),
            clientsEmptyState: document.getElementById('clients-empty-state'),
            clientStats: document.getElementById('client-stats'),
            clientStatsEmpty: document.getElementById('client-stats-empty'),
            totalClients: document.getElementById('total-clients'),
            totalClientProjects: document.getElementById('total-client-projects'),
            
            // Project elements
            projectsTableBody: document.getElementById('projects-table-body'),
            projectsEmptyState: document.getElementById('projects-empty-state'),
            projectSearch: document.getElementById('project-search'),
            projectFilter: document.getElementById('project-filter'),
            
            // Modals
            printerModal: document.getElementById('printer-modal'),
            filamentModal: document.getElementById('filament-modal'),
            clientModal: document.getElementById('client-modal'),
            projectDetailsModal: document.getElementById('project-details-modal'),
            confirmModal: document.getElementById('confirm-modal'),
            modalCloseButtons: document.querySelectorAll('.modal-close'),
            
            // Forms
            printerForm: document.getElementById('printer-form'),
            filamentForm: document.getElementById('filament-form'),
            clientForm: document.getElementById('client-form'),
            
            // Toast
            toast: document.getElementById('toast'),
            toastMessage: document.getElementById('toast-message'),
            toastIcon: document.getElementById('toast-icon'),
            
            // Loading overlay
            loadingOverlay: document.getElementById('loading-overlay')
        };

        // Utility Functions
        const utils = {
            formatCurrency(value) {
                return `R$ ${parseFloat(value).toFixed(2)}`;
            },
            
            formatDate(timestamp) {
                const date = new Date(timestamp);
                return date.toLocaleDateString('pt-BR');
            },
            
            formatTime(hours, minutes) {
                return `${hours}h ${minutes}min`;
            },
            
            generateId() {
                return 'id_' + Date.now();
            },
            
            getInitials(name) {
                if (!name) return '';
                return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
            },
            
            showToast(message, type = 'success') {
                elements.toastMessage.textContent = message;
                
                if (type === 'success') {
                    elements.toastIcon.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    `;
                    elements.toastIcon.className = 'mr-3 text-green-500';
                } else {
                    elements.toastIcon.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    `;
                    elements.toastIcon.className = 'mr-3 text-red-500';
                }
                
                elements.toast.classList.remove('translate-y-20', 'opacity-0');
                
                setTimeout(() => {
                    elements.toast.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            },
            
            showLoading() {
                elements.loadingOverlay.classList.remove('hidden');
            },
            
            hideLoading() {
                elements.loadingOverlay.classList.add('hidden');
            },
            
            showModal(modal) {
                modal.classList.remove('hidden');
            },
            
            hideModal(modal) {
                modal.classList.add('hidden');
            },
            
            hideAllModals() {
                elements.printerModal.classList.add('hidden');
                elements.filamentModal.classList.add('hidden');
                elements.clientModal.classList.add('hidden');
                elements.projectDetailsModal.classList.add('hidden');
                elements.confirmModal.classList.add('hidden');
            },
            
            showConfirmModal(title, message, callback) {
                document.getElementById('confirm-title').textContent = title;
                document.getElementById('confirm-message').textContent = message;
                
                const confirmButton = document.getElementById('confirm-action');
                confirmButton.onclick = () => {
                    callback();
                    utils.hideModal(elements.confirmModal);
                };
                
                utils.showModal(elements.confirmModal);
            },
            
            applyTheme() {
                const body = document.body;
                const isDark = state.theme === 'dark';
                
                body.classList.toggle('dark', isDark);
                body.classList.toggle('light', !isDark);
                
                // Update inputs
                document.querySelectorAll('.input').forEach(input => {
                    input.classList.toggle('input-dark', isDark);
                    input.classList.toggle('input-light', !isDark);
                });
                
                // Update cards
                document.querySelectorAll('.card').forEach(card => {
                    card.classList.toggle('card-dark', isDark);
                    card.classList.toggle('card-light', !isDark);
                });
                
                // Update theme toggle button
                const toggleButton = elements.themeToggle;
                const toggleSpan = toggleButton.querySelector('span');
                
                if (isDark) {
                    toggleSpan.classList.add('translate-x-6');
                    toggleSpan.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                        </svg>
                    `;
                } else {
                    toggleSpan.classList.remove('translate-x-6');
                    toggleSpan.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-yellow-500" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
                        </svg>
                    `;
                }
                
                // Update tabs
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    if (tab.classList.contains('active')) {
                        tab.classList.toggle('text-blue-600', !isDark);
                        tab.classList.toggle('text-blue-400', isDark);
                    } else {
                        tab.classList.toggle('hover:text-gray-600', !isDark);
                        tab.classList.toggle('hover:text-gray-300', isDark);
                    }
                });
            },
            
            exportToPDF(elementId, filename) {
                const { jsPDF } = window.jspdf;
                const element = document.getElementById(elementId);
                
                html2canvas(element).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgWidth = 210;
                    const pageHeight = 295;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;
                    
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    pdf.save(`${filename}.pdf`);
                });
            }
        };

        // Authentication Controller
        const authController = {
            init() {
                // Check if user is already logged in
                app.auth.onAuthStateChanged(user => {
                    if (user) {
                        this.handleAuthSuccess(user);
                    } else {
                        elements.authScreen.classList.remove('hidden');
                        elements.mainApp.classList.add('hidden');
                    }
                });
                
                // Login tab click
                elements.loginTab.addEventListener('click', () => {
                    elements.loginTab.classList.add('tab-active-light');
                    elements.loginTab.classList.remove('tab-inactive-light');
                    elements.registerTab.classList.add('tab-inactive-light');
                    elements.registerTab.classList.remove('tab-active-light');
                    elements.loginForm.classList.remove('hidden');
                    elements.registerForm.classList.add('hidden');
                });
                
                // Register tab click
                elements.registerTab.addEventListener('click', () => {
                    elements.registerTab.classList.add('tab-active-light');
                    elements.registerTab.classList.remove('tab-inactive-light');
                    elements.loginTab.classList.add('tab-inactive-light');
                    elements.loginTab.classList.remove('tab-active-light');
                    elements.registerForm.classList.remove('hidden');
                    elements.loginForm.classList.add('hidden');
                });
                
                // Login button click
                elements.loginButton.addEventListener('click', async () => {
                    const email = document.getElementById('login-email').value;
                    const password = document.getElementById('login-password').value;
                    
                    if (!email || !password) {
                        utils.showToast('Preencha todos os campos', 'error');
                        return;
                    }
                    
                    try {
                        utils.showLoading();
                        const userCredential = await app.auth.signInWithEmailAndPassword(email, password);
                        this.handleAuthSuccess(userCredential);
                    } catch (error) {
                        utils.showToast('Erro ao fazer login: ' + error.message, 'error');
                    } finally {
                        utils.hideLoading();
                    }
                });
                
                // Register button click
                elements.registerButton.addEventListener('click', async () => {
                    const name = document.getElementById('register-name').value;
                    const email = document.getElementById('register-email').value;
                    const password = document.getElementById('register-password').value;
                    const confirmPassword = document.getElementById('register-confirm-password').value;
                    
                    if (!name || !email || !password || !confirmPassword) {
                        utils.showToast('Preencha todos os campos', 'error');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        utils.showToast('As senhas não coincidem', 'error');
                        return;
                    }
                    
                    try {
                        utils.showLoading();
                        const userCredential = await app.auth.createUserWithEmailAndPassword(email, password);
                        
                        // Update user profile with name
                        const user = userCredential;
                        user.displayName = name;
                        
                        this.handleAuthSuccess(user);
                    } catch (error) {
                        utils.showToast('Erro ao criar conta: ' + error.message, 'error');
                    } finally {
                        utils.hideLoading();
                    }
                });
                
                // Google login button click
                elements.googleLogin.addEventListener('click', async () => {
                    try {
                        utils.showLoading();
                        const result = await app.auth.signInWithPopup();
                        this.handleAuthSuccess(result.user);
                    } catch (error) {
                        utils.showToast('Erro ao fazer login com Google: ' + error.message, 'error');
                    } finally {
                        utils.hideLoading();
                    }
                });
                
                // Google register button click
                elements.googleRegister.addEventListener('click', async () => {
                    try {
                        utils.showLoading();
                        const result = await app.auth.signInWithPopup();
                        this.handleAuthSuccess(result.user);
                    } catch (error) {
                        utils.showToast('Erro ao fazer login com Google: ' + error.message, 'error');
                    } finally {
                        utils.hideLoading();
                    }
                });
                
                // Logout button click
                elements.logoutButton.addEventListener('click', async () => {
                    try {
                        utils.showLoading();
                        await app.auth.signOut();
                        state.currentUser = null;
                        elements.authScreen.classList.remove('hidden');
                        elements.mainApp.classList.add('hidden');
                        elements.userMenu.classList.add('hidden');
                    } catch (error) {
                        utils.showToast('Erro ao fazer logout: ' + error.message, 'error');
                    } finally {
                        utils.hideLoading();
                    }
                });
                
                // User menu button click
                elements.userMenuButton.addEventListener('click', () => {
                    elements.userMenu.classList.toggle('hidden');
                });
                
                // Close user menu when clicking outside
                document.addEventListener('click', (event) => {
                    if (!elements.userMenuButton.contains(event.target) && !elements.userMenu.contains(event.target)) {
                        elements.userMenu.classList.add('hidden');
                    }
                });
            },
            
            handleAuthSuccess(user) {
                state.currentUser = user;
                
                // Update UI
                elements.userName.textContent = user.displayName || user.email.split('@')[0];
                elements.userEmail.textContent = user.email;
                elements.menuUserName.textContent = user.displayName || user.email.split('@')[0];
                elements.menuUserEmail.textContent = user.email;
                elements.userInitials.textContent = utils.getInitials(user.displayName || user.email);
                
                // Hide auth screen and show main app
                elements.authScreen.classList.add('hidden');
                elements.mainApp.classList.remove('hidden');
                
                // Load user data
                dataController.loadUserData();
            }
        };

        // Data Controller
        const dataController = {
            async loadUserData() {
                utils.showLoading();
                
                try {
                    // Load printers
                    const printersSnapshot = await app.firestore.collection('printers').where('userId', '==', state.currentUser.uid).get();
                    state.printers = printersSnapshot.docs.map(doc => doc.data());
                    
                    // Load filaments
                    const filamentsSnapshot = await app.firestore.collection('filaments').where('userId', '==', state.currentUser.uid).get();
                    state.filaments = filamentsSnapshot.docs.map(doc => doc.data());
                    
                    // Load clients
                    const clientsSnapshot = await app.firestore.collection('clients').where('userId', '==', state.currentUser.uid).get();
                    state.clients = clientsSnapshot.docs.map(doc => doc.data());
                    
                    // Load projects
                    const projectsSnapshot = await app.firestore.collection('projects').where('userId', '==', state.currentUser.uid).get();
                    state.projects = projectsSnapshot.docs.map(doc => doc.data());
                    
                    // Update UI
                    uiController.updatePrintersUI();
                    uiController.updateFilamentsUI();
                    uiController.updateClientsUI();
                    uiController.updateProjectsUI();
                    uiController.updateSelectOptions();
                    
                } catch (error) {
                    console.error('Error loading user data:', error);
                    utils.showToast('Erro ao carregar dados', 'error');
                } finally {
                    utils.hideLoading();
                }
            },
            
            async savePrinter(printer) {
                utils.showLoading();
                
                try {
                    const printerId = printer.id || utils.generateId();
                    const printerData = {
                        ...printer,
                        id: printerId,
                        userId: state.currentUser.uid,
                        createdAt: Date.now()
                    };
                    
                    await app.firestore.collection('printers').doc(printerId).set(printerData);
                    
                    // Update local state
                    const index = state.printers.findIndex(p => p.id === printerId);
                    if (index !== -1) {
                        state.printers[index] = printerData;
                    } else {
                        state.printers.push(printerData);
                    }
                    
                    uiController.updatePrintersUI();
                    uiController.updateSelectOptions();
                    utils.showToast('Impressora salva com sucesso');
                    
                } catch (error) {
                    console.error('Error saving printer:', error);
                    utils.showToast('Erro ao salvar impressora', 'error');
                } finally {
                    utils.hideLoading();
                }
            },
            
            async deletePrinter(printerId) {
                utils.showLoading();
                
                try {
                    await app.firestore.collection('printers').doc(printerId).delete();
                    
                    // Update local state
                    state.printers = state.printers.filter(p => p.id !== printerId);
                    
                    uiController.updatePrintersUI();
                    uiController.updateSelectOptions();
                    utils.showToast('Impressora excluída com sucesso');
                    
                } catch (error) {
                    console.error('Error deleting printer:', error);
                    utils.showToast('Erro ao excluir impressora', 'error');
                } finally {
                    utils.hideLoading();
                }
            },
            
            async saveFilament(filament) {
                utils.showLoading();
                
                try {
                    const filamentId = filament.id || utils.generateId();
                    const filamentData = {
                        ...filament,
                        id: filamentId,
                        userId: state.currentUser.uid,
                        createdAt: Date.now()
                    };
                    
                    await app.firestore.collection('filaments').doc(filamentId).set(filamentData);
                    
                    // Update local state
                    const index = state.filaments.findIndex(f => f.id === filamentId);
                    if (index !== -1) {
                        state.filaments[index] = filamentData;
                    } else {
                        state.filaments.push(filamentData);
                    }
                    
                    uiController.updateFilamentsUI();
                    uiController.updateSelectOptions();
                    utils.showToast('Filamento salvo com sucesso');
                    
                } catch (error) {
                    console.error('Error saving filament:', error);
                    utils.showToast('Erro ao salvar filamento', 'error');
                } finally {
                    utils.hideLoading();
                }
            },
            
            async deleteFilament(filamentId) {
                utils.showLoading();
                
                try {
                    await app.firestore.collection('filaments').doc(filamentId).delete();
                    
                    // Update local state
                    state.filaments = state.filaments.filter(f => f.id !== filamentId);
                    
                    uiController.updateFilamentsUI();
                    uiController.updateSelectOptions();
                    utils.showToast('Filamento excluído com sucesso');
                    
                } catch (error) {
                    console.error('Error deleting filament:', error);
                    utils.showToast('Erro ao excluir filamento', 'error');
                } finally {
                    utils.hideLoading();
                }
            },
            
            async saveClient(client) {
                utils.showLoading();
                
                try {
                    const clientId = client.id || utils.generateId();
                    const clientData = {
                        ...client,
                        id: clientId,
                        userId: state.currentUser.uid,
                        createdAt: Date.now()
                    };
                    
                    await app.firestore.collection('clients').doc(clientId).set(clientData);
                    
                    // Update local state
                    const index = state.clients.findIndex(c => c.id === clientId);
                    if (index !== -1) {
                        state.clients[index] = clientData;
                    } else {
                        state.clients.push(clientData);
                    }
                    
                    uiController.updateClientsUI();
                    uiController.updateSelectOptions();
                    utils.showToast('Cliente salvo com sucesso');
                    
                } catch (error) {
                    console.error('Error saving client:', error);
                    utils.showToast('Erro ao salvar cliente', 'error');
                } finally {
                    utils.hideLoading();
                }
            },
            
            async deleteClient(clientId) {
                utils.showLoading();
                
                try {
                    await app.firestore.collection('clients').doc(clientId).delete();
                    
                    // Update local state
                    state.clients = state.clients.filter(c => c.id !== clientId);
                    
                    uiController.updateClientsUI();
                    uiController.updateSelectOptions();
                    utils.showToast('Cliente excluído com sucesso');
                    
                } catch (error) {
                    console.error('Error deleting client:', error);
                    utils.showToast('Erro ao excluir cliente', 'error');
                } finally {
                    utils.hideLoading();
                }
            },
            
            async saveProject(project) {
                utils.showLoading();
                
                try {
                    const projectId = project.id || utils.generateId();
                    const projectData = {
                        ...project,
                        id: projectId,
                        userId: state.currentUser.uid,
                        createdAt: Date.now()
                    };
                    
                    await app.firestore.collection('projects').doc(projectId).set(projectData);
                    
                    // Update local state
                    const index = state.projects.findIndex(p => p.id === projectId);
                    if (index !== -1) {
                        state.projects[index] = projectData;
                    } else {
                        state.projects.push(projectData);
                    }
                    
                    uiController.updateProjectsUI();
                    utils.showToast('Projeto salvo com sucesso');
                    
                } catch (error) {
                    console.error('Error saving project:', error);
                    utils.showToast('Erro ao salvar projeto', 'error');
                } finally {
                    utils.hideLoading();
                }
            },
            
            async deleteProject(projectId) {
                utils.showLoading();
                
                try {
                    await app.firestore.collection('projects').doc(projectId).delete();
                    
                    // Update local state
                    state.projects = state.projects.filter(p => p.id !== projectId);
                    
                    uiController.updateProjectsUI();
                    utils.showToast('Projeto excluído com sucesso');
                    
                } catch (error) {
                    console.error('Error deleting project:', error);
                    utils.showToast('Erro ao excluir projeto', 'error');
                } finally {
                    utils.hideLoading();
                }
            }
        };

        // Calculator Controller
        const calculatorController = {
            init() {
                elements.calculateButton.addEventListener('click', () => {
                    this.calculatePrice();
                });
                
                elements.saveProjectButton.addEventListener('click', () => {
                    this.saveProject();
                });
                
                elements.exportPdfButton.addEventListener('click', () => {
                    const pieceName = document.getElementById('piece-name').value || 'projeto';
                    utils.exportToPDF('results-container', pieceName);
                });
            },
            
            calculatePrice() {
                // Get input values
                const pieceName = document.getElementById('piece-name').value;
                const clientId = document.getElementById('client-select').value;
                const printTimeHours = parseFloat(document.getElementById('print-time-hours').value) || 0;
                const printTimeMinutes = parseFloat(document.getElementById('print-time-minutes').value) || 0;
                const pieceWeight = parseFloat(document.getElementById('piece-weight').value) || 0;
                const printerId = document.getElementById('printer-select').value;
                const filamentId = document.getElementById('filament-select').value;
                const energyCost = parseFloat(document.getElementById('energy-cost').value) || 0;
                const packagingCost = parseFloat(document.getElementById('packaging-cost').value) || 0;
                const failureRate = parseFloat(document.getElementById('failure-rate').value) || 0;
                const taxRate = parseFloat(document.getElementById('tax-rate').value) || 0;
                const cardFee = parseFloat(document.getElementById('card-fee').value) || 0;
                const adCost = parseFloat(document.getElementById('ad-cost').value) || 0;
                const markup = parseFloat(document.getElementById('markup').value) || 0;
                
                // Validate required fields
                if (!pieceName || !printerId || !filamentId || pieceWeight <= 0 || (printTimeHours <= 0 && printTimeMinutes <= 0)) {
                    utils.showToast('Preencha todos os campos obrigatórios', 'error');
                    return;
                }
                
                // Get printer and filament data
                const printer = state.printers.find(p => p.id === printerId);
                const filament = state.filaments.find(f => f.id === filamentId);
                
                if (!printer || !filament) {
                    utils.showToast('Selecione uma impressora e um filamento válidos', 'error');
                    return;
                }
                
                // Calculate costs
                const totalPrintTimeHours = printTimeHours + (printTimeMinutes / 60);
                
                // Filament cost
                const filamentCost = (pieceWeight / 1000) * parseFloat(filament.price);
                
                // Energy cost
                const energyConsumption = (parseFloat(printer.power) / 1000) * totalPrintTimeHours;
                const energyCostValue = energyConsumption * energyCost;
                
                // Depreciation cost
                const depreciationCost = (parseFloat(printer.cost) / parseFloat(printer.lifespan)) * totalPrintTimeHours;
                
                // Failure cost
                const directCosts = filamentCost + energyCostValue + depreciationCost + packagingCost;
                const failureCost = directCosts * (failureRate / 100);
                
                // Tax cost
                const taxCost = directCosts * (taxRate / 100);
                
                // Card fee cost
                const cardFeeCost = directCosts * (cardFee / 100);
                
                // Ad cost
                const adCostValue = directCosts * (adCost<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'964ca0f0178338d3',t:'MTc1MzQ1NjY5My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
